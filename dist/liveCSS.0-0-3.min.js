// Live CSS, Dynamic CSS module for AngularJS
// > 0.0.3
// > ofzza, 2014.
// > build: Thu Jul 17 2014 14:38:19
"use strict";!function(){var a={},b={scheduler:{registry:{},execute:function(c,d,e){b.scheduler.registry[c]?(d?b.scheduler.registry[c].fn=d:d=b.scheduler.registry[c].fn,e?b.scheduler.registry[c].timeout=e:e=b.scheduler.registry[c].timeout):b.scheduler.registry[c]={fn:d,timeout:e,timestamp:0,pending:!1};var f=(new Date).getTime(),g=b.scheduler.registry[c];if(!g.pending)if(e=e>0?e:100,f-g.timestamp>=e)"function"==typeof d&&d(),g.timestamp=(new Date).getTime();else{var h=e-(f-g.timestamp);g.pending=!0,a.$timeout(function(){g.pending=!1,b.scheduler.execute(c)},h)}}}};!function(){var a=angular.module("LiveCss",["LiveCssCore","LiveCssToolkit","LiveCssDirectives"]);a.provider("LiveCss",[function(){return{$get:["LiveCssCore","LiveCssToolkit",function(a,b){var c={element:b.element};return angular.extend(c,a),c}]}}])}(),function(){var c=angular.module("LiveCssCore",[]),d={documents:{},extensions:{}},e=function(a,b){var c=document.createElement("LiveCssParser");c.innerHTML=a;for(var d=c.childNodes,e=[],g=0;g<d.length;g++)if("#comment"!=d[g].nodeName){var h=d[g],i=null;if(h.localName?i=h:h.textContent.trim().length>0&&(i=document.createElement("document"),i.innerHTML=h.textContent),i){for(var j in b)angular.element(i).attr(j,b[j]);e.push(new f(i))}}return e},f=function(b){var c={host:{document:null,compilation:null,interpolation:null},attrs:{source:null,compile:null,interpolate:null},"import":[],syntax:{loaded:null,compiled:null,interpolated:null},watcher:null,initialize:function(){var f=angular.element(b);if(f.attr("key")){var g=null;try{g=e.$scope.$eval(f.attr("key").trim())}catch(h){}e.key=g?g:f.attr("key").trim()}f.attr("import")&&f.attr("import").trim().length>0&&(c.import=e.$scope.$eval(f.attr("import").trim()));for(var i in c.attrs)f.attr(i)&&f.attr(i).trim().length>0&&(c.attrs[i]=f.attr(i).trim());f.attr("key",e.key),d.documents[e.key]=e;var j={key:e.key,syntax:b.innerHTML};a.$rootScope.$broadcast("$lcssSyntaxLoaded",j),c.syntax.loaded=j.syntax.trim();var k=document.createElement("liveCss"),l=angular.element(k);l.attr("key",e.key);for(var g in c.attrs)l.attr(g,c.attrs[g]);c.host.document=k,document.head.appendChild(k);var m=function(a,b){var c={};for(var d in b)b.hasOwnProperty(d)&&"undefined"==typeof b.__proto__[d]&&(c[d]=b[d]);for(var d in a)a.hasOwnProperty(d)&&d&&"$"!=d[0]&&"this"!=d&&"undefined"==typeof a.__proto__[d]&&(c[d]=a[d]);return c};c.watcher=e.$scope.$watch(function(){var b={compilation:c.attrs.compile?e.$scope.$eval(c.attrs.compile):m(a.$rootScope.$lcss,e.$scope),interpolation:c.attrs.interpolate?e.$scope.$eval(c.attrs.interpolate):m(a.$rootScope.$lcss,e.$scope)};return b},function(a,b){!c.syntax.compiled||a.compilation&&!angular.equals(a.compilation,b.compilation)?c.compile():a.interpolation&&!angular.equals(a.interpolation,b.interpolation)&&c.interpolate()},!0)},compile:function(b){if(c.syntax.loaded){if(a.LiveCssDebugger)var d=a.LiveCssDebugger.stats.domains.get(["compile",e.key]).time();c.host.compilation||(c.host.compilation=document.createElement("liveCssCompiler")),c.host.compilation.innerHTML=c.syntax.loaded;var f=angular.element(c.host.compilation),g=angular.element(c.host.document),h=e.$scope.$new();a.$compile(f)(h,function(f,h){f&&(g.append(f),a.$timeout(function(){var g=f[0].innerHTML;g=g.replace(/\[\[/g,"{{").replace(/\]\]/g,"}}"),h.$destroy(),h.$on("$destroy",function(){f.off()}),f.remove(),f=null;var i=document.createElement("liveCssCompilerCleanup");i.innerHTML=g;do{for(var j=[],k=0;k<i.childNodes.length;k++)i.childNodes[k].localName&&j.push(i.childNodes[k]);for(var k=0;k<j.length;k++)j[k].outerHTML=j[k].innerHTML+"\r\n"}while(j.length>0);g=i.innerHTML;do{var l=g.indexOf("<!--"),m=g.indexOf("-->",l)+"-->".length;l>=0&&m>=0&&(g=g.substr(0,l)+g.substr(m))}while(l>=0&&m>=0);if(g=g.trim(),c.syntax.compiled!=g||!c.attrs.compile||!c.attrs.interpolate){var n={key:e.key,syntax:g};a.$rootScope.$broadcast("$lcssSyntaxCompiled",n),c.syntax.compiled=c.unhtmlize(n.syntax),c.interpolate(b)}d&&d.stop()}))})}},interpolate:function(b){if(c.syntax.compiled){if(a.LiveCssDebugger)var d=a.LiveCssDebugger.stats.domains.get(["interpolate",e.key]).time();var f=a.$interpolate(c.syntax.compiled)(e.$scope);if(c.syntax.interpolated!=f){f=c.unhtmlize(f),c.syntax.interpolated=f,c.host.interpolation||(c.host.interpolation=document.createElement("style"),c.host.document.appendChild(c.host.interpolation));var g={key:e.key,syntax:c.syntax.interpolated};a.$rootScope.$broadcast("$lcssSyntaxInterpolated",g),c.syntax.interpolated=g.syntax,c.host.interpolation.innerHTML=c.syntax.interpolated,b&&b()}d&&d.stop()}},unhtmlize:function(a){for(var b={"&lt;":"<","&gt;":">"},c=0;(c=a.indexOf("&",c))>=0;){var d=a.indexOf(";",c),e=a.substr(c,d-c+1),f=b[e];a=a.substr(0,c)+f+a.substr(d+1),c+=(f?f.length:0)-(e?e.length:0)}return a},destroy:function(){c.watcher(),c.host.document&&angular.element(c.host.document).remove(),c.host.compilation&&angular.element(c.host.compilation).remove(),c.host.interpolation&&angular.element(c.host.interpolation).remove(),e.$scope.$destroy(),e.$scope.$on("$destroy",function(){})}},e={key:((new Date).getTime()+1e6*Math.random()).toString(16),"import":function(){return c.import},$scope:a.LiveCssCore.pub.$rootScope.$new(),syntax:c.syntax,compile:c.compile,interpolate:c.interpolate,destroy:c.destroy};return c.initialize(),e},g=function(c,e,f,g,h){this.key=c;var i=[];this.setAdditionalKeys=function(a){i=a},d.extensions[c]&&delete d.extensions[c],d.extensions[c]=this;var j=null,k=function(a,b,d,e){a[c]||(a[c]={});var f=b(a[c],d,e);"undefined"!=typeof f&&(a[c]=f)};if(f&&"function"==typeof f){var l=function(){for(var a in d.documents)if("string"==typeof d.documents[a]){if(this.key==d.documents[a])return!0}else{if("object"!=typeof d.documents[a]||"undefined"==typeof d.documents[a].length)return[];if(d.documents[a].indexOf(this.key)>=0)return!0}return!1};j=a.$rootScope.$lcss.$watch(function(){return l()?f():null},function(f,j){b.scheduler.execute(this.key,function(){if(a.LiveCssDebugger)var b=a.LiveCssDebugger.stats.domains.get(["extension","lcss","watched",c],i).time();if(h){var g=a.$rootScope.$lcss;k(g,e,f,j)}else for(var l in d.documents)if(d.documents[l].import().indexOf(c)>=0){var g=d.documents[l].$scope;k(g,e,f,j)}b&&b.stop()},g>0?g:0)},!0)}this.apply=function(){if(a.LiveCssDebugger)var f=a.LiveCssDebugger.stats.domains.get(["extension","lcss","applyed",c],i).time();b.scheduler.execute(this.key,function(){if(h){var b=a.$rootScope.$lcss;k(b,e)}else for(var f in d.documents)if(d.documents[f].import().indexOf(c)>=0){var b=d.documents[f].$scope;k(b,e),b.$$phase||b.$digest()}},g>0?g:0),f&&f.stop()},a.$rootScope.$on("$lcssSyntaxLoaded",function(){if(a.LiveCssDebugger)var b=a.LiveCssDebugger.stats.domains.get(["extension","lcss","loaded",c],i).time();if(h){var f=a.$rootScope.$lcss;k(f,e)}else for(var g in d.documents)if(d.documents[g].import().indexOf(c)>=0){var f=d.documents[g].$scope;k(f,e),f.$$phase||f.$digest()}b&&b.stop()}),this.apply()};c.provider("LiveCssCore",[function(){return{$get:["$compile","$interpolate","$rootScope","$q","$http","$timeout",function(b,c,f,h,i,j){a.$compile=b,a.$interpolate=c,a.$rootScope=f,a.$q=h,a.$http=i,a.$timeout=j,a.$rootScope.$lcss=f.$new(),a.$rootScope.$lcss.fetch=a.$rootScope.$lcss.get=function(a){return d.documents[a]};var k={$rootScope:a.$rootScope.$lcss,fetch:function(a){return a?prv.documents[a]:void 0},get:this.fetch,"import":function(a,b){var c=e(a,b?b:{source:null});return c},importUrl:function(a){var b=h.defer();return i.get(a).then(function(c){var d=k.import(c.data,{source:a});b.resolve(d)},function(c){var d=k.import("/*"+c.status+"*/",{source:a,error:c.status});b.resolve(d)}),b.promise},extend:function(a,b,c,d,e){return"number"==typeof c&&"number"!=typeof d&&(d=c),new g(a,b,c,d,e)},$$services:function(){return a}};return a.LiveCssCore={pub:k,prv:d},k}]}}])}(),function(){var c=angular.module("LiveCssToolkit",["LiveCssCore"]),d={element:{uniqueKeyCount:0,elementScope:null,elementScopeDigesting:!1,instantDigest:!1,extensions:{}}},e=function(c,e,f){this.key=c,this.element=e,this.imports=f;var g=this.uniqueKey=e.id?e.id:((new Date).getTime()+1e6*Math.random()).toString(16)+"#"+(d.element.uniqueKeyCount++).toString(16),h=[];if("string"==typeof f)d.element.extensions[f]&&(h=[d.element.extensions[f]]);else if(f&&"object"==typeof f&&"undefined"!=typeof f.length)for(var i=0;i<f.length;i++)d.element.extensions[f[i]]&&h.push(d.element.extensions[f[i]]);else h=[];for(var j=[],k=null,i=0;i<h.length;i++)h[i].events&&(j.push(h[i]),k="number"==typeof h[i].timeout?h[i].timeout:1e3);for(var i=0;i<j.length;i++){var l=j[i],m=function(d,f){return function(h){if(a.LiveCssDebugger)var i=a.LiveCssDebugger.stats.domains.get(["extension","lcss-element","event",c,g],d.getAdditionalKeys()).time();b.scheduler.execute(this.key,function(){for(var b in a.LiveCssCore.prv.documents)if(a.LiveCssCore.prv.documents[b].import().indexOf("element")>=0){var j=a.LiveCssCore.prv.documents[b].$scope;j.element||(j.element={}),j.element[c]||(j.element[c]={}),j.element[c][g]||(j.element[c][g]={});var k=d.applyFn(e,j.element[c][g],f,h);"undefined"!=typeof k&&(j.element[c][g]=k),j.$$phase||j.$digest()}i&&i.stop()},k?k:0)}};if("string"==typeof l.events){var n=m(l,l.events);angular.element(this.element).on(l.events,n),n()}else if("object"==typeof l.events&&"undefined"!=typeof l.events.length)for(var o=0;o<l.events.length;o++){var n=m(l,l.events[o]);angular.element(this.element).on(l.events[o],n),n()}}for(var p=[],q=null,i=0;i<h.length;i++)h[i].events||(p.push(h[i]),q="number"==typeof h[i].timeout?h[i].timeout:1e3);var r=!d.element.elementScope;d.element.elementScope||(d.element.elementScope=a.$rootScope.$lcss.$new(!0)),r&&a.$rootScope.$on("$lcssSyntaxLoaded",function(){d.element.elementScopeDigesting||a.$rootScope.$$phase||d.element.elementScope.$$phase||(d.element.elementScopeDigesting=!0,d.element.elementScope.$digest(),d.element.elementScopeDigesting=!1)});var s=function(){for(var b={},d=0;d<p.length;d++){var f=p[d];if(a.LiveCssDebugger)var h=a.LiveCssDebugger.stats.domains.get(["extension","lcss-element","polling","watch",c,g],f.getAdditionalKeys()).time();var i=f.applyFn(e,b);i&&(b=i),h&&h.stop()}return b},t=function(b,d){for(var e in a.LiveCssCore.prv.documents)if(a.LiveCssCore.prv.documents[e].import().indexOf("element")>=0){var f=a.LiveCssCore.prv.documents[e].$scope;if(d||!f.element||!f.element[c]||f.element[c][g]){f.element||(f.element={}),f.element[c]||(f.element[c]={}),f.element[c][g]||(f.element[c][g]={});for(var h in b)f.element[c][g][h]=b[h]}}},u=null,v=0,w=d.element.elementScope.$watch(function(){if(!e)return w(),null;var b=(new Date).getTime();if(!(d.element.instantDigest||b-v>q))return u;v=b;for(var c in a.LiveCssCore.prv.documents)if(a.LiveCssCore.prv.documents[c].import().indexOf("element")>=0){var f=s();return t(f,!1),f}},function(e){e&&b.scheduler.execute("PolledPropertyChange-"+g,function(){if(a.LiveCssDebugger)var b=a.LiveCssDebugger.stats.domains.get(["extension","lcss-element","polling","apply",c,g]).time();u=e,d.element.instantDigest=!0,t(e,!0),b&&b.stop()},10)},!0);this.destroy=function(){w()}},f=function(a,b,c,e){this.key=a;var f=["?"];this.getAdditionalKeys=function(){return f},this.setAdditionalKeys=function(a){f=a},this.applyFn=b,this.timeout=c,this.events=e,d.element.extensions[a]=this};c.provider("LiveCssToolkit",[function(){return{$get:["LiveCssCore","$timeout",function(b,c){var g={element:{bind:function(a,b,c){if("undefined"!=typeof b.length){for(var d=[],f=0;f<b.length;f++)d.push(new e(a,b[f],c));return d}return new e(a,b[f],c)},extend:function(a,b,c,d){return new f(a,b,c,d)}}},h=Object.create(Math,{});h.round=function(a,b){return"undefined"==typeof b?Math.round(a):Math.round(a*Math.pow(10,b))/Math.pow(10,b)},h.ceil=function(a,b){return"undefined"==typeof b?Math.ceil(a):Math.ceil(a*Math.pow(10,b))/Math.pow(10,b)},h.floor=function(a,b){return"undefined"==typeof b?Math.floor(a):Math.floor(a*Math.pow(10,b))/Math.pow(10,b)},b.extend("Math",function(a){return a=h},null,0,!0);var i=Object.create(Array,{});i.range=function(a,b){for(var c=[],d="undefined"==typeof b?0:a;("undefined"==typeof b?a:b)>d;d++)c.push(d);return c},b.extend("Array",function(a){return a=i},null,0,!0);var j=b.extend("window",function(a){a.size={width:window.innerWidth,height:window.innerHeight}},null,200);j.setAdditionalKeys(["size"]),angular.element(window).on("resize",function(){j.apply()});var k=b.extend("window",function(a){a.scroll={x:window.scrollX,y:window.scrollY}},null,200);k.setAdditionalKeys(["scroll"]),angular.element(window).on("scroll",function(){k.apply()});var l={timeout:{promise:null,interval:1e3,nextExec:0,lastExec:0},position:{x:window.innerWidth/2,y:window.innerHeight/2,history:[]}},m=function(a){return function(b){l.position.history.push({time:(new Date).getTime(),x:b.clientX,y:b.clientY,distance:Math.sqrt(Math.pow(l.position.x-b.clientX,2)+Math.pow(l.position.y-b.clientY,2))}),l.position.history.length>256&&(l.position.history=l.position.history.splice(1)),l.position.x=b.clientX,l.position.y=b.clientY,a.apply()}},n=function(a,b,d){d||(d=1e3);var e=(new Date).getTime()+b;l.timeout.lastExec=l.timeout.lastExec>e?l.timeout.lastExec:e,l.timeout.interval=l.timeout.interval<d?l.timeout.interval:d,function f(a){var b=(new Date).getTime()+l.timeout.interval;(a||!l.timeout.promise||!l.timeout.nextExec||b<l.timeout.nextExec)&&(l.timeout.promise&&(c.cancel(l.timeout.promise),l.timeout.promise=null),l.timeout.promise=c(function(){l.timeout.promise=null,o.apply(),(new Date).getTime()<l.timeout.lastExec&&f()},l.timeout.interval),l.timeout.nextExec=b)}(!0)},o=b.extend("mouse",function(a){a.position={time:(new Date).getTime(),x:l.position.x/window.innerWidth,y:l.position.y/window.innerHeight,clientX:l.position.x,clientY:l.position.y,history:a&&a.position&&a.position.history?a.position.history:{exists:function(a){var b=(new Date).getTime(),c=a&&0!=l.position.history.length?b-l.position.history[l.position.history.length-1].time<a:!1;return a&&c&&n(o,a,a),c},points:function(a,b){var c=(new Date).getTime();if(a){for(var d=[],e=l.position.history.length-1;e>=0;e--)if(c-l.position.history[e].time>a){for(var f=e+1;f<l.position.history.length;f++)d.push(l.position.history[f]);break}return n(o,a,b),d}return l.position.history},distance:function(a,b){var c=(new Date).getTime();if(a){for(var d=0,e=l.position.history.length-1;e>=0&&c-l.position.history[e].time<=a;e--)d+=l.position.history[e].distance;return d&&n(o,a,b),d}return l.position.history.length>0?l.position.history[l.position.history.length-1]:0}}}},null,40);o.setAdditionalKeys(["position"]),angular.element(window).on("mousemove",m(o)),angular.element(window).on("click",m(o)),angular.element(window).on("touchstart",m(o));var p=function(a,b){b.size={width:a.clientWidth,height:a.clientHeight,clientWidth:a.clientWidth,clientHeight:a.clientHeight,offsetWidth:a.offsetWidth,offsetHeight:a.offsetHeight}},q=g.element.extend("size",p,200);q.setAdditionalKeys(["size"]);return a.LiveCssToolkit={pub:g,prv:d},g}]}}])}(),function(){var a=angular.module("LiveCssDirectives",["LiveCssCore","LiveCssToolkit"]),b={},c=function(a,c,d){b[a]||(b[a]={docs:[],elements:[]});for(var e=0;e<c.length;e++)b[a].docs.push(c[e]);b[a].elements.push(d[0])},d=function(a,c){if(b[a]){for(var d=0;d<b[a].elements.length;d++)if(c[0]==b[a].elements[d]){b[a].elements.splice(d,1);break}if(0==b[a].elements.length){for(var d=0;d<b[a].docs.length;d++)b[a].docs[d].destroy();delete b[a]}}};a.directive("lcssSrc",["LiveCssCore","LiveCssToolkit",function(a){return{scope:!0,link:function(e,f,g){e.$watch(function(){return e.$eval(g.lcssSrc)},function(e,g){d(g,f);var h=e;b[h]?(c(h,[],f),f.on("$destroy",function(){d(h,f)})):a.importUrl(h).then(function(a){c(h,a,f),f.on("$destroy",function(){d(h,f)})})})}}}]),a.directive("lcssElement",["LiveCssCore","LiveCssToolkit",function(a,b){return{scope:!0,link:function(a,c,d){var e={watcher:null};a.$watch(function(){var b=a.$eval(d.lcssElement);return{key:b?b:d.lcssElement,imports:d.lcssElementImport?a.$eval(d.lcssElementImport):null}},function(a){e.watcher&&e.watcher.destroy(),e.watcher=b.element.bind(a.key,c,a.imports)},!0)}}}])}()}();