// Live CSS, Dynamic CSS module for AngularJS
// > 0.0.1
// > ofzza, 2014.
// > build: Sat Jun 21 2014 01:52:29
"use strict";!function(){var a={};!function(){var a=angular.module("LiveCss",["LiveCssCore","LiveCssToolkit","LiveCssDirectives"]);a.provider("LiveCss",[function(){return{$get:["LiveCssCore","LiveCssToolkit",function(a,b){var c={element:b.element,container:b.container};return angular.extend(c,a),c}]}}])}(),function(){var b=angular.module("LiveCssCore",[]),c=function(a,b){var c=document.createElement("LiveCssParser");c.innerHTML=a;for(var e=c.childNodes,f=[],g=0;g<e.length;g++){var h=e[g],i=null;if(h.localName?i=h:h.textContent.trim().length>0&&(i=document.createElement("document"),i.innerHTML=h.textContent),i){for(var j in b)angular.element(i).attr(j,b[j]);f.push(new d(i))}}return f},d=function(b){var c={host:{document:null,compilation:null,interpolation:null},attrs:{source:null,compile:null,interpolate:null},"import":[],syntax:{loaded:null,compiled:null,interpolated:null},initialize:function(){var e=angular.element(b);e.attr("key")&&(d.key=e.attr("key").trim()),e.attr("import")&&(c.import=d.$scope.$eval(e.attr("import").trim()));for(var f in c.attrs)e.attr(f)&&(c.attrs[f]=e.attr(f));if(e.attr("key",d.key),angular.isArray(c.import))for(var g=0;g<c.import.length;g++)angular.isNumber(a.LiveCssCore.prv.imports[c.import[g]])?a.LiveCssCore.prv.imports[c.import[g]]+=1:a.LiveCssCore.prv.imports[c.import[g]]=1;var h={key:d.key,syntax:b.innerHTML};a.$rootScope.$broadcast("LiveCssDocument-SyntaxLoaded",h),c.syntax.loaded=h.syntax.trim();var i=document.createElement("liveCss"),j=angular.element(i);j.attr("key",d.key);for(var k in c.attrs)j.attr(k,c.attrs[k]);c.host.document=i,document.head.appendChild(i);var l=function(a,b){var c={};for(var d in b)b.hasOwnProperty(d)&&"undefined"==typeof b.__proto__[d]&&(c[d]=b[d]);for(var d in a)a.hasOwnProperty(d)&&d&&"$"!=d[0]&&"this"!=d&&"undefined"==typeof a.__proto__[d]&&(c[d]=a[d]);return c};d.$scope.$watch(function(){var b={compilation:c.attrs.compile?d.$scope.$eval(c.attrs.compile):l(a.$rootScope,d.$scope),interpolation:c.attrs.interpolate?d.$scope.$eval(c.attrs.interpolate):l(a.$rootScope,d.$scope)};return b},function(a,b){!c.syntax.compiled||a.compilation&&!angular.equals(a.compilation,b.compilation)?c.compile():a.interpolation&&!angular.equals(a.interpolation,b.interpolation)&&c.interpolate()},!0)},compile:function(b){if(c.syntax.loaded){c.host.compilation||(c.host.compilation=document.createElement("liveCssCompiler")),c.host.compilation.innerHTML=c.syntax.loaded;var e=angular.element(c.host.compilation),f=angular.element(c.host.document),g=d.$scope.$new();a.$compile(e)(g,function(e,g){e&&(f.append(e),a.$timeout(function(){var f=e[0].innerHTML;f=f.replace(/\[\[/g,"{{").replace(/\]\]/g,"}}"),g.$destroy(),g.$on("$destroy",function(){e.off()}),e.remove(),e=null;var h=document.createElement("liveCssCompilerCleanup");h.innerHTML=f;do{for(var i=[],j=0;j<h.childNodes.length;j++)h.childNodes[j].localName&&i.push(h.childNodes[j]);for(var j=0;j<i.length;j++)i[j].outerHTML=i[j].innerHTML+"\r\n"}while(i.length>0);f=h.innerHTML;do{var k=f.indexOf("<!--"),l=f.indexOf("-->",k)+"-->".length;k>=0&&l>=0&&(f=f.substr(0,k)+f.substr(l))}while(k>=0&&l>=0);if(f=f.trim(),c.syntax.compiled!=f||!c.attrs.compile||!c.attrs.interpolate){var m={key:d.key,syntax:f};a.$rootScope.$broadcast("LiveCssDocument-SyntaxCompiled",m),c.syntax.compiled=m.syntax,c.interpolate(b)}}))})}},interpolate:function(b){if(c.syntax.compiled){var e=a.$interpolate(c.syntax.compiled)(d.$scope);if(c.syntax.interpolated!=e){e=c.unhtmlize(e),c.syntax.interpolated=e,c.host.interpolation||(c.host.interpolation=document.createElement("style"),c.host.document.appendChild(c.host.interpolation));var f={key:d.key,syntax:c.syntax.interpolated};a.$rootScope.$broadcast("LiveCssDocument-SyntaxInterpolated",f),c.syntax.interpolated=f.syntax,c.host.interpolation.innerHTML=c.syntax.interpolated,b&&b()}}},unhtmlize:function(a){return a}},d={key:((new Date).getTime()+1e6*Math.random()).toString(16),$scope:a.LiveCssCore.pub.$rootScope.$new(),syntax:c.syntax,compile:c.compile,interpolate:c.interpolate};return c.initialize(),d},e=function(b,c,d,e){this.key=b;var f=!0;this.start=function(){f=!0},this.stop=function(){f=!1};var g=this.apply=function(){f&&a.LiveCssCore.prv.imports[b]&&(d(e,c()),e.$$phase||e.$apply())};this.destroy=function(){h(),delete a.LiveCssCore.prv.watchers[b]},a.LiveCssCore.prv.imports[b]&&this.apply(),this.$dependancies={register:function(){a.LiveCssCore.prv.imports[b]+=1,f&&regs>0&&g()},unregister:function(){a.LiveCssCore.prv.imports[b]-=1}};var h=e.$watch(function(){return f&&a.LiveCssCore.prv.imports[b]?c():!1},function(c){f&&a.LiveCssCore.prv.imports[b]&&d(e,c)},!0)};b.provider("LiveCssCore",[function(){return{$get:["$compile","$interpolate","$rootScope","$q","$http","$timeout",function(b,d,f,g,h,i){a.$compile=b,a.$interpolate=d,a.$rootScope=f,a.$q=g,a.$http=h,a.$timeout=i,a.$rootScope.$lcss=f,a.$rootScope.$lcss.document=function(a){return j.documents[a]};var j={documents:{},watchers:{},imports:{},watcherClass:e},k={$rootScope:a.$rootScope.$new(),fetch:function(b){return b?j.documents[b]:{$scope:a.$rootScope}},get:this.fetch,"import":function(a,b){for(var d=c(a,b?b:{source:"local"}),e=0;e<d.length;e++)j.documents[d[e].key]=d[e];return d},importUrl:function(a){var b=g.defer();return h.get(a).then(function(c){var d=k.import(c.data,{source:a});b.resolve(d)},function(c){var d=k.import("/*"+c.status+"*/",{source:a,error:c.status});b.resolve(d)}),b.promise},watcher:function(a,b,c){return j.watchers[a]=new e(a,b,c,k.$rootScope),j.watchers[a]}};return a.LiveCssCore={pub:k,prv:j},k}]}}])}(),function(){var b=angular.module("LiveCssToolkit",["LiveCssCore"]),c=function(b,c){this.key=b,this.watchFn=c,this.destroy=function(){delete a.LiveCssToolkit.prv.element.watchFns[b]}},d=function(b,c,d,e){this.key=b;var f=this.uniqueKey=c.id?c.id:((new Date).getTime()+1e6*Math.random()).toString(16);this.element=c;var g=function(){var b={};for(var d in a.LiveCssToolkit.prv.element.watchFns)b[d]=a.LiveCssToolkit.prv.element.watchFns[d].watchFn(c);return b},h=function(a,c){a.element||(a.element={}),a.element[b]||(a.element[b]={}),a.element[b][f]=c},i=new a.LiveCssCore.prv.watcherClass("element",g,h,e);if(a.LiveCssToolkit.prv.element.watchers[b][f]=i,c&&d)for(var j=0;j<d.length;j++)c.addEventListener(d[j],function(){i.apply()},!0);this.start=function(){i.start()},this.stop=function(){i.stop()},this.destroy=function(){if(i.destroy(),c&&d)for(var e=0;e<d.length;e++)c.removeEventListener(d[e]);for(var e=0;e<d.length;e++)c.addEventListener(d[e],function(){i.apply()});delete a.LiveCssToolkit.prv.element.watchers[b][f]},this.apply=function(){i.apply()}};b.provider("LiveCssToolkit",[function(){return{$get:["LiveCssCore",function(b){var e={element:{watchFns:{},watchers:{}},containment:{containers:{}}},f={element:{watcher:function(a,b){return e.element.watchFns[a]=new c(a,b),e.element.watchFns[a]},watch:function(b,c,f){e.element.watchers[b]||(e.element.watchers[b]={});for(var g=[],h=angular.element(c),i=0;i<h.length;i++)g.push(new d(b,h[i],f?f:[],a.LiveCssCore.pub.$rootScope));return g}},container:{add:function(b,c){var d=a.LiveCssCore.pub.fetch(b);d&&(d.$scope.container||(d.$scope.container=function(a){var c="";if(e.containment.containers[b])for(var d=0;d<e.containment.containers[b].length;d++)c+=(c.length>0?",\r\n":"")+"."+e.containment.containers[b][d].cssClass+" "+a+" ";return c}));for(var f=angular.element(c),g=0;g<f.length;g++){var h="livecss-container-"+((new Date).getTime()+1e6*Math.random()).toString(16).replace(/\./g,"-");angular.element(f[g]).addClass(h),e.containment.containers[b]||(e.containment.containers[b]=[]),e.containment.containers[b].push({element:f[g],cssClass:h})}d.compile()},remove:function(a,b){for(var c=angular.element(b),d=0;d<c.length;d++)if(e.containment.containers[a])for(var f=0;d<e.containment.containers[a].length;f++)if(e.containment.containers[a][f]==c[d]){e.containment.containers[a].splice(f,1);break}document.compile()}}};f.element.watcher("size",function(a){return{width:a.clientWidth,height:a.clientHeight,clientWidth:a.clientWidth,clientHeight:a.clientHeight,offsetWidth:a.offsetWidth,offsetHeight:a.offsetHeight}}),f.element.watcher("scroll",function(a){return{x:a.scrollLeft,y:a.scrollTop}}),f.element.watcher("value",function(a){return a.value?a.value:null},["change"]);var g=Object.create(Math,{});g.round=function(a,b){return"undefined"==typeof b?Math.round(a):Math.round(a*Math.pow(10,b))/Math.pow(10,b)},g.ceil=function(a,b){return"undefined"==typeof b?Math.ceil(a):Math.ceil(a*Math.pow(10,b))/Math.pow(10,b)},g.floor=function(a,b){return"undefined"==typeof b?Math.floor(a):Math.floor(a*Math.pow(10,b))/Math.pow(10,b)},b.fetch().Math=g,b.fetch().$scope.Math=g;var h=Object.create(Array,{});h.range=function(a,b){for(var c=[],d="undefined"==typeof b?0:a;("undefined"==typeof b?a:b)>d;d++)c.push(d);return c},b.fetch().Array=h,b.fetch().$scope.Array=h;var i=b.watcher("window",function(){return{size:{width:window.innerWidth,height:window.innerHeight},scroll:{x:window.scrollX,y:window.scrollY}}},function(a,b){a.window=b});window.addEventListener("resize",function(){i.apply()},!0),window.addEventListener("scroll",function(){i.apply()},!0);{var j={x:null,y:null};b.watcher("mouse",function(){return{position:{x:j.x/window.innerWidth,y:j.y/window.innerHeight,clientX:j.x,clientY:j.y}}},function(a,b){a.mouse=b})}return document.body.addEventListener("mousemove",function(a){j={x:a.clientX,y:a.clientY},i.apply()},!0),document.body.addEventListener("click",function(a){j={x:a.clientX,y:a.clientY},i.apply()},!0),document.body.addEventListener("touchstart",function(a){j={x:a.clientX,y:a.clientY},i.apply()},!0),a.LiveCssToolkit={pub:f,prv:e},f}]}}])}(),function(){var a=angular.module("LiveCssDirectives",["LiveCssCore","LiveCssToolkit"]);a.directive("lcssSrc",["LiveCssCore","LiveCssToolkit",function(a){return{scope:!0,link:function(b,c,d){var e=b.$eval(d.lcssSrc);a.importUrl(e).then(function(){})}}}])}()}();